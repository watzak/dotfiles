# Set prefix to Ctrl+A (must be first!)
set -g prefix C-a
unbind C-b                       # Unbind default prefix
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g pane-base-index 1
set -g mouse on                  # Enable mouse control (clickable windows, panes, resizable panes)
set -g set-clipboard on          # use system clipboard
set -g status-position top       # macOS / darwin style
set -g escape-time 0             # zero-out escape time delay
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set-option -g focus-events on

# Set terminal title to show tmux session name (for WezTerm tabs)
set-option -g set-titles on
set-option -g set-titles-string "[#S] #W"  # [session] window
set-option -g allow-rename on

# Umgebungsvariablen für GUI-Anwendungen (DISPLAY, WAYLAND, etc.)
# Diese Variablen werden automatisch aktualisiert, wenn neue Sessions/Windows erstellt werden
# Note: Tmux default includes SSH_CONNECTION, SSH_CLIENT, SSH_TTY, DISPLAY, SSH_AUTH_SOCK
# Uncomment below if you need additional environment variables
# set-option -a update-environment "WAYLAND_DISPLAY"
# set-option -a update-environment "WINDOWID"
# set-option -a update-environment "XAUTHORITY"
# set-option -a update-environment "DBUS_SESSION_BUS_ADDRESS"


# Split or create windows with current pane path
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
# bind C-g display-popup -d "#{pane_current_path}" -xC -yC -w70% -h70% -E "lazygit"

# Reload config shortcut (Prefix + r)
bind-key -T prefix r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Zoom toggle (Prefix + z)
bind-key -T prefix z resize-pane -Z

# Update DISPLAY variable (Prefix + D) - nützlich nach Wiederherstellung oder Reconnect
bind-key -T prefix D run-shell ~/.config/tmux/scripts/update-display.sh

# Hook: Aktualisiere DISPLAY automatisch beim Client-Attach
# Note: Commented out due to invalid environment variable error
# set-hook -g client-attached 'run-shell "tmux set-environment -g DISPLAY \"${DISPLAY:-:0}\""'

set-option -g status on
set-option -g status-interval 2
set-option -g status-justify "centre"
set-option -g status-left-length 61
set-option -g status-right-length 91

# Liste der zu installierenden Plugins
set -g @plugin 'tmux-plugins/tpm'
set-option -g @plugin 'b0o/tmux-autoreload'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum' # Automatische Speicherung
set -g @plugin 'tmux-plugins/tmux-yank'     # Besser kopieren
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Visuelles Feedback
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'dracula/tmux'

# Weitere Einstellungen für Resurrect und Continuum
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'  # Speichert auch den Inhalt der Panes
set -g @continuum-restore 'on'                # Automatische Wiederherstellung beim Start
set -g @continuum-save-interval '5'           # Speichere alle 5 Minuten (häufiger für bessere Persistenz)
set -g @continuum-save-on-exit 'on'   # Speichere automatisch beim Beenden
set -g @resurrect-save 'S'                    # Manuelles Speichern mit Prefix+S
set -g @resurrect-restore 'R'                 # Manuelles Wiederherstellen mit Prefix+R
# Speichere wichtige Umgebungsvariablen (DISPLAY für GUI-Apps)
set -g @resurrect-save-shell-history 'on'
# Hinweis: Automatischer Start beim Boot wird über systemd Service (tmux-resurrect.service) gehandhabt
set -g @dracula-plugins "cpu-usage gpu-usage ram-usage"
set -g @dracula-cpu-usage-colors "pink dark_gray"
set -g @dracula-show-flags true
set -g @dracula-border-contrast true
set -g @dracula-show-powerline true
set -g @dracula-show-left-icon session  # Show session name on the left

# Prefix nochmal setzen nach Plugins (falls Plugin es überschreibt)
set -g prefix C-a
unbind C-b


# Verwende zsh als Standard-Shell für alle tmux Sessions
# Dies stellt sicher, dass zoxide und andere zsh-Konfigurationen verfügbar sind
set -g default-shell /usr/bin/zsh

# Stelle sicher, dass .zshrc in tmux Sessions geladen wird (login shell)
# -l Flag lädt .zprofile, .zshrc, etc. automatisch
set-option -g default-command "zsh -l"


# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

